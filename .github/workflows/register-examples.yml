name: Register Example Components

on:
  push:
    branches:
      - test-branch
    paths:
      - 'examples/**/*'

jobs:
  detect-changes:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.detect.outputs.matrix }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - id: files
        uses: jitterbit/get-changed-files@v1
        with:
          format: 'json'
      - id: detect
        name: Detect changes
        run: echo "::set-output name=matrix::${{ steps.files.outputs.modified }}"
      # - id: detect
      #   name: Detect changes
      #   run: |
      #     export CHANGED_DIRS=$(find ./examples/*/architect.yml -type f -maxdepth 0 -exec sh -c 'test $(git diff-tree --name-only --no-commit-id -r ${{ github.sha }} -- $(dirname $1) | wc -c) -ne 0 && dirname $1' sh {}  \;)
      #     echo "changed dirs below"
      #     echo $CHANGED_DIRS
      #     echo "::set-output name=matrix::$(jq -n -c --arg v "$CHANGED_DIRS" '{"component_path": $v | split("\n") }')"

  # register-components:
  #   needs: detect-changes
  #   runs-on: ubuntu-latest
  #   strategy:
  #     matrix: ${{fromJson(needs.detect-changes.outputs.matrix)}}
  #   steps:
  #     - uses: actions/checkout@master
  #     - name: test
  #       run: echo "test" #${{ matrix.component_path }}
      # - name: Setup Node.js
      #   uses: actions/setup-node@v1
      #   with:
      #     node-version: '12.x'
      # - name: Install Architect CLI
      #   run: npm i -g @architect-io/cli --unsafe-perm
      # - name: Architect login
      #   run: architect login -e ${{ secrets.ARCHITECT_EXAMPLES_ACCT_EMAIL }} -p ${{ secrets.ARCHITECT_EXAMPLES_ACCT_PASSWORD }}
      # - name: Register component
      #   run: architect register ${{ matrix.component_path }} -t latest
